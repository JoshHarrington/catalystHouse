function handleTimeout(e){if((new Date).getTime()>=flatAlertTimestamps[e]){var t=document.getElementById("endUserScreen"+e);t.className="phone"}}var PAGE,MESSAGE_TIME=8e3,configState=0,nextKeyCodeIndex=0,validConfigKeyDown=0,triggers=[{name:"Bathroom flooded",msgStaffOn:"The floor in flat 2 is wet",msgStaffOff:"The floor in flat 2 is dry",msgCustomerOn:"The floor in flat 2 is wet. We'll be round shortly",msgCustomerOff:"The floor in flat 2 is dry again",msgCustomerOnClass:"user2-flood",msgCustomerOffClass:"user2-flood-fix",currentKeyState:0,keyCode:-1,affectsFlats:[1]},{name:"Top light off (RHS switch)",msgStaffOn:"The light in flat 1 is broken",msgStaffOff:"The light in flat 1 is better",msgCustomerOn:"The light in flat 1 is broken. We'll be round shortly",msgCustomerOff:"The light in flat 1 is better",msgCustomerOnClass:"user1-aptLight",msgCustomerOffClass:"user1-aptLight-fix",currentKeyState:0,keyCode:-1,affectsFlats:[0]},{name:"Main entrance light off (LHS switch)",msgStaffOn:"The main entrance light is broken",msgStaffOff:"The main entrance light is better",msgCustomerOn:"The main entrance light is broken. We'll be round shortly",msgCustomerOff:"The main entrance light is better",msgCustomerOnClass:"foyerLight",msgCustomerOffClass:"foyerLight-fix",currentKeyState:0,keyCode:-1,affectsFlats:[0,1]}],EVENT={BATH_WATER:0,MAIN_ENTRANCE_LIGHT:1,FLAT_LIGHT:2},flatAlertTimestamps=[0,0];!function(e){"use strict";PAGE=function(){function t(){e("article").addClass("hide"),e(".setup").removeClass("hide"),n()}function n(){e(".hello").html("Activate the "+triggers[nextKeyCodeIndex].name+" condition")}function s(e){for(var t=-1,n=0;n<triggers.length;n++)if(triggers[n].keyCode==e){t=n;break}-1!=t&&1!=triggers[t].currentKeyState&&(triggers[t].currentKeyState=1,i(t,!1))}function r(e){for(var t=-1,n=0;n<triggers.length;n++)if(triggers[n].keyCode==e){t=n;break}-1!=t&&0!=triggers[t].currentKeyState&&(triggers[t].currentKeyState=0,i(t,!0))}function i(e,t){a(e,!t);for(var n=0;n<triggers[e].affectsFlats.length;n++)o(e,triggers[e].affectsFlats[n],!t)}function a(t,n){f("StaffScreen"),n?e(".main .StaffScreen ul").append('<li class="alert">'+triggers[t].msgStaffOn+"</li>"):e(".main .StaffScreen ul").append("<li>"+triggers[t].msgStaffOff+"</li>")}function o(t,n,s){f("endUserScreen"+n),s?e(".main .endUserScreen"+n+" .phone").removeClass().addClass("phone "+triggers[t].msgCustomerOnClass):e(".main .endUserScreen"+n+" .phone").removeClass().addClass("phone "+triggers[t].msgCustomerOffClass),flatAlertTimestamps[n]=(new Date).getTime()+(MESSAGE_TIME-100),setTimeout("handleTimeout("+n+")",MESSAGE_TIME)}function f(t){var n=e(".main ."+t+" ul li");n.length>=10&&n.first().remove()}function g(e){var t=e.keyCode?e.keyCode:e.charCode;m(t,!1)}function l(e){var t=e.keyCode?e.keyCode:e.charCode;m(t,!0)}function m(e,t){switch(e){case 87:case 65:case 83:case 68:case 70:case 71:case 32:case 38:case 40:case 39:case 37:t?0==configState?d(e):r(e):0==configState?c(e):s(e)}}function c(t){for(var n=-1,s=0;s<triggers.length;s++)if(triggers[s].keyCode==t){n=s;break}-1==n&&(triggers[nextKeyCodeIndex].keyCode=t,validConfigKeyDown=1,e(".hello").html("Deactivate the "+triggers[nextKeyCodeIndex].name+" condition"))}function d(){1==validConfigKeyDown&&(validConfigKeyDown=0,nextKeyCodeIndex++,nextKeyCodeIndex==triggers.length?(configState=1,e(".setup").addClass("hide"),e(".main").removeClass("hide")):n())}return{init:function(){document.onkeydown=g,document.onkeyup=l,t()}}}(),e(function(){PAGE.init()})}(jQuery);